# Slack → CLI Relay (AIツール連携)

SlackのEvent APIから受信したイベントを、サーバ側で検証・受理し、バックグラウンドでAI系CLIツール（例: Claude Code 等）へリレー転送するためのシンプルなブリッジです。  
本READMEは骨子（アウトライン）です。詳細手順は後日追記予定です。

## 1. 概要
- 目的: Slackからの通知を外部CLIツールへ中継し、チャットから開発支援/自動化タスクを実行できるようにする。
- 方式: Slack Event API → 署名検証 → キュー投入 → CLI実行 → 結果処理（任意）。
- 特徴: CLIツールは差し替え可能／キュー駆動で非同期処理／最小構成で動作。

## 2. 必要要件
- PHP 8.1+
- Laravel 10
- Redis（推奨。代替: database キュー等も可）
- Supervisor（または同等の常駐プロセス管理）
- 外部CLIツール（例: Claude Code。任意のCLIに置換可能）
- Slack App（Event Subscriptions有効化、Signing Secret取得）
- Slack通知用のMCPサーバ

## 3. クイックスタート（最小構成）
- 前提
  - Slack Appを作成済みで、Signing Secretを取得している。
  - 外部CLIツールが単体で動作確認済み。
  - 外部CLIツールにSlack MCPサーバをインストール、設定を行い、Slackにメッセージ送信できる事を確認済み。
  - 外部CLIツール用のプロファイルを用意、適切なディレクトリに配置済み。 `docs/profile.sample.json` がサンプルファイルなので、これを元にテキストを作成する。
- 最小手順（概要）
  1) リポジトリを取得し依存関係をインストール。
  2) 環境変数（例: Slack署名シークレット、キュー接続、CLI実行コマンド/パス）を設定。
  3) アプリケーションを起動（HTTPサーバ）し、キューワーカーを常駐起動。
  4) SlackのEvent Subscriptionsで受信エンドポイントを設定し、URL Verificationを通過させる。
  5) テスト用イベントを送信して疎通確認（ログ/通知で判定）。
- 期待する動作
  - URL Verificationが成功すること。
  - イベント受信時にジョブがエンキューされ、外部CLIが呼び出されること。

## 4. 詳細セットアップ（後日追記）
- 4.1 リレー（本ツール）の設定
- 4.2 CLIツール（Claude Code 等）の設定と差し替えガイド
- 4.3 Slack側の設定（スコープ、Event Subscriptions、再試行）

## 5. 運用（後日追記）
- Supervisorによる常駐化
- ログ/監視
- レート制御と再試行ポリシー

## 6. セキュリティと制限事項（後日追記）
- Slack署名検証と時刻スキュー対策
- 必要最小権限（スコープ）の付与
- CLI実行権限/サンドボックス
- 冪等性（重複配送対策）

## 7. 免責事項
本システムは十分なセキュリティ検証を経ていません。本システムの利用により直接的または間接的に発生したいかなる損失・損害についても、作者は一切の責任を負いません。自己の責任においてご利用ください。

## 8. ライセンス
MIT License。詳細は LICENSE ファイルを参照してください。
